<link rel="import" href="../paper-dialog-scrollable/paper-dialog-scrollable.html">
<link rel="import" href="../paper-swatch-picker/paper-swatch-picker.html">
<link rel="import" href="../paper-button/paper-button.html">
<link rel="import" href="../paper-dialog/paper-dialog.html">
<link rel="import" href="../paper-input/paper-input.html">
<link rel="import" href="../paper-fab/paper-fab.html">
<dom-module id="deko-deck-editor">
  <template>
    <style>
      .templateButtons {
        text-align: center;
        margin-top: 40px;
      }
      paper-button-group {
        margin: 15px;
      }
      paper-fab {
        position: fixed;
        right: 25px;
        bottom: 30px;          
      }
    </style>
    <template is="dom-if" if="[[!noAdd]]">
      <paper-fab icon="add" on-tap="add"></paper-fab>
    </template>
    <paper-dialog id="dialog" modal>
      <paper-dialog-scrollable>
        <paper-input value="{{deck.title}}" label="Name the Deck"></paper-input>
        <paper-swatch-picker color="{{deck.color}}"></paper-swatch-picker>
      </paper-dialog-scrollable>
      <div class="buttons">
        <paper-button on-tap="delete" style="color:#333">Delete</paper-button>
        <paper-button dialog-dismiss>Cancel</paper-button>
        <paper-button on-tap="save" raised style="background:#ff4081;color:#fff">Save</paper-button>
      </div>
    </paper-dialog>
  </template>
  <script>
    Polymer({
      is: 'deko-deck-editor',
      properties: {
        deck: {
          type: Object,
          notify: true,
        },
        inputFrom:String,
        updateValues: {
          computed: ("getUpdateValues(card.*)")
        },
        usedTemplate: {
          computed: "getUsedTemplate(theTemplates, card, useTemplates)"
        },
        noAdd:{
          type:Boolean,
          value:false,
        },
      },
      getInputFrom: function(form) {
        this.async(this.getUpdateValues, 100) // let it load
        return form
      },
      getUpdateValues: function(card) {
        if (card) {
          this.async(this.getUpdateValues, 100) // let it load
        } else {
          if (!this.card) {
            this.card = {}
          }
          var inputForm = this.$$("#cardInputs")
          var items = inputForm.querySelectorAll("[label]")
          for (var i=0, max=items.length; i < max; i++) {
            if (this.card.hasOwnProperty(items[i].label)) {
              items[i].value = this.card[items[i].label]
            }
          }
          return "Done"
        }
      },
      save: function() {
        this.close('save')
      },
      delete: function() {
        this.close('delete')
      },
      close: function(detail) {
        this.fire('close', detail, { bubbles: false })
        this.$.dialog.close()
      },
      resetForm: function() {
        this.set("inputFrom","")
        this.set("inputFrom",this.getInputFrom(this.theTemplate))
      },
      add: function() {
        this.resetForm()
        this.open({})
      },
      open: function(card) {
        this.resetForm()
        if (card) {
          this.card = card
        }
        this.async(this.getUpdateValues, 100)
        this.$.dialog.open()
      },
      objectToArray: function(data) { //rewrite as .map
        var output = []
        if (data) {
          var keys = Object.keys(data)
          for (var i = 0; i < keys.length; i++) {
            if (typeof data[keys[i]] === 'object') {
              data[keys[i]]["__key"] = keys[i]
              output.push(data[keys[i]])
            }
          }
        }
        return output
      }
    })
  </script>
</dom-module>
